<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title> Glam Wear Admin -Categories </title>
  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="vendors/feather/feather.css">
  <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap'); /* Import bold Poppins font */

.navbar-menu-wrapper {
    width: 100%;                     /* Ensure wrapper takes full width */
    display: flex;                   /* Flexbox layout */
    justify-content: space-between;  /* Space between heading and button */
    align-items: center;             /* Vertically align items */
}

.order-details-heading {
    font-family: 'Poppins', sans-serif; /* Use Poppins for a bold style */
    font-weight: 600;                   /* Poppins weight */
    font-size: 2.3rem;                  /* Adjust font size */
    color: #333;                        /* Dark text color */
    text-align: center;                 /* Center text */
    flex-grow: 1;                       /* Make the heading take available space */
    margin: 0;                          /* Remove default margin */
    padding: 20px;                      /* Add padding around the heading */
}

.navbar-nav-right {
    margin-left: auto; /* Push the button to the far right */
}
.sidebar {
  background-color: #343a40;
    position: fixed; /* Keeps the sidebar in a fixed position */
    top: 30px; /* Aligns it to the top */
    left: 0; /* Aligns it to the left */
    width: 250px; /* Adjust as needed */
    height: 100%; /* Full height */
    overflow-y: auto; /* Allows scrolling if the sidebar content overflows */
    z-index: 1000; /* Ensures it stays above other elements */
}

.main-panel {
    margin-left: 250px; /* Adjust based on sidebar width */
    padding: 20px; /* Add padding to the main content */
}
.brand-logo {
    display: flex; /* Flexbox can help with alignment */
    align-items: center; /* Center vertically */
}

.logo-img {
    width: 215px !important; /* Desired width */
    height: auto !important; /* Maintain aspect ratio */
}
</style>

<body>

  <div class="container-scroller">
    <!--Navbar -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center" style="background-color: #343a40;">
        <a class="navbar-brand brand-logo" href="">
          <img class="logo-img" src="/assets/images/whtundebrwn.png" alt="Molla Logo">
      </a>
        <a class="navbar-brand brand-logo-mini" href="index.html"><img src="images/glamundrwht.svg" alt="logo" /></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-between">
        <h1 class="text-center mb-4 order-details-heading">Categories</h1>
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item dropdown d-lg-flex d-none">
            <button type="button" class="btn btn-info font-weight-bold" data-toggle="modal"
              data-target="#addCategoryModal">Add Category</button>
          </li>
      </div>
    </nav>

    <div class="container-fluid page-body-wrapper">

      <!-- Sidebar -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="user-profile">
          <div class="user-image">
            <img src="images/faces/admin.jpg">
          </div>
          <div class="user-name">
            Fahmida Sherin
          </div>
          <div class="user-designation">
            Manager
          </div>
        </div>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="/admin/dashboard">
              <i class="icon-box menu-icon"></i>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/custommer">
              <i class="icon-command menu-icon"></i>
              <span class="menu-title">Customers</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/categories">
              <i class="icon-disc menu-icon"></i>
              <span class="menu-title">Category</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/products">
              <i class="icon-file menu-icon"></i>
              <span class="menu-title">Products</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/order">
              <i class="icon-pie-graph menu-icon"></i>
              <span class="menu-title">Orders</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/coupons">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Coupons</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/offers">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Offers</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/salesReport">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Sales Report</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/logout">
              <i class="icon-head menu-icon"></i>
              <span class="menu-title">Logout</span>
            </a>
          </li>

        </ul>
      </nav>

      <!-- Main container -->
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row">
            <div class="col-lg-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <div class="pagination">
                    <% if (currentPage> 1) { %>
                      <button class="btn btn-primary" onclick="goToPage(<%= currentPage - 1 %>)">Previous</button>
                      <% } %>

                        <% for (let i=1; i <=totalPages; i++) { %>
                          <button class="btn btn-primary <%= currentPage === i ? 'active' : '' %>"
                            onclick="goToPage(<%= i %>)">
                            <%= i %>
                          </button>
                          <% } %>

                            <% if (currentPage < totalPages) { %>
                              <button class="btn btn-primary" onclick="goToPage(<%= currentPage + 1 %>)">Next</button>
                              <% } %>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-striped w-100 ">
                      <thead>
                        <tr>
                          <th style="width: 20%;">SI.NO</th>
                          <th style="width: 20%;">NAME</th>
                          <th style="width: 25%;">DESCRIPTION</th>
                          <th style="width: 0;">ACTION</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% if(locals.categorys){ %>
                          <% locals.categorys.forEach((category, index)=> { %>
                            <tr>
                              <td>
                                <%= index + 1 %>
                              </td>
                              <td>
                                <%= category.name %>
                              </td>
                              <td>
                                <%= category.description %>
                              </td>
                              <td>
                                <div class="d-grid gap-2 d-md-flex">
                                  <div
                                    onclick='edit("<%= category.name %>","<%= category.description.replace(/(\r\n|\n|\r)/gm, " ") %>" ,"<%= category._id %>")'>

                                    <button class="btn btn-primary edit-btn" data-toggle="modal"
                                      data-target="#editCategoryModal" data-categoryid="<%= category._id %>"
                                      data-categoryname="<%= category.name %>"
                                      data-categorydescription="<%= category.description %>">Edit</button>

                                    <button class="btn btn-outline-primary" id="toggleCategiryBtn<%= index %>"
                                      onclick="toggleCategoryStatus('<%= category._id %>', '<%= index %>')"
                                      type="button">
                                      <%= category.status ? 'Listed' : 'UnListed' %>
                                    </button>

                                    <button onclick="deleteMe('<%= category._id %>')" type="button"
                                      class="btn btn-danger font-weight-bold" id="delete-btn">DELETE</button>
                                  </div>
                                </div>
                              </td>
                            </tr>
                            <% }) %>

                              <% } else { %>
                                <tr>
                                  <td colspan="4">
                                    <h2>NO category found</h2>
                                  </td>
                                </tr>
                              <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>




      <!-- Add Modal -->
      <div class="modal fade" id="addCategoryModal" tabindex="-1" aria-labelledby="addCategoryModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addCategoryModalLabel">Add Category</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <form id="addCategoryForm" action="/admin/categories" oninput="" method="put">
              <div class="modal-body">

                <div class="form-group">
                  <label for="categoryName">category Name</label>
                  <input type="text" class="form-control" id="categoryName" name="categoryName"
                    placeholder="Enter category name">
                  <span id="categoryNameError" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="categoryDescription">Category Description</label>
                  <textarea class="form-control" id="categoryDescription" rows="3" name="categoryDescription"
                    placeholder="Enter category description"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" id="saveChangesBtn">Save changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>


      <!-- Edit Modal -->
      <div class="modal fade" id="editCategoryModal" tabindex="-1" role="dialog"
        aria-labelledby="editCategoryModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div>
              <div class="modal-header">
                <h5 class="modal-title" id="editCategoryModalLabel">Edit Category</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">

                <div class="form-group">
                  <label for="editCategoryName">Category Name</label>
                  <input type="text" class="form-control" id="editCategoryName" name="name"
                    placeholder="Enter category name">
                </div>
                <div class="form-group">
                  <label for="editCategoryDescription">Category Description</label>
                  <textarea class="form-control" id="editCategoryDescription" rows="3" name="des"
                    placeholder="Enter category description"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button onclick="editCategory()" type="submit" class="btn btn-primary" id="saveChangesBtn">Save
                  Changes</button>
              </div>
            </div>
          </div>
        </div>
      </div>



      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
      <script>

        // add category
        document.getElementById('addCategoryForm').addEventListener('submit', async (event) => {
          event.preventDefault();
          console.log("entered sdd vcst")
          const categoryName = document.getElementById('categoryName').value
          const categoryDescription = document.getElementById('categoryDescription').value

          if (categoryName.trim() === '' || categoryDescription.trim() === '') {
            alert('please enter both name and description')
            return
          }
          fetch('/admin/categories', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ categoryName, categoryDescription })
          }).then((res) => res.json()).then((data) => {
            console.log(data)
            if (data.msg) {
              alert('Category already exist!')
            }
            if (data.status) {
              window.location.href = '/admin/categories';
            }
          }).catch(error => {
            console.log(error.message)
          })
        })


        // edit category
        const desc = document.getElementById('editCategoryDescription');
        const name1 = document.getElementById('editCategoryName');
        let categoryId;
        async function editCategory() {
          const editedName = name1.value;
          const description = desc.value;
          try {
            const editedName = name1.value
            const editedDescription = desc.value
            const response = await fetch(`/admin/categories/${categoryId}/edit`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ name: editedName, desc: editedDescription })
            })
            window.location.href = '/admin/categories'

          } catch (error) {
            console.log(error.message);
          }
        }
        function edit(name, des, id) {
          console.log("edit");
          console.log("edit ID : ", id);
          name1.value = name;
          desc.value = des
          categoryId = id;
        }




        // update list and unlist 
        function toggleCategoryStatus(categoryId, index) {
          const buttonId = `toggleCategiryBtn${index}`;
          console.log('Button ID:', buttonId);
          const button = document.getElementById(`toggleCategiryBtn${index}`);
          Swal.fire({
            title: 'Are you sure?',
            text: `Do you want to ${button.innerHTML === 'Listed' ? 'unlist' : 'list'} this category?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, do it!',
            cancelButtonText: 'No, cancel'
          }).then((result) => {
            if (result.isConfirmed) {
              fetch(`/admin/categories/${categoryId}/updateStatus`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                }
              })
                .then(response => {
                  console.log('Response received:', response);
                  return response.json()
                })
                .then(data => {
                  console.log('Data:', data);
                  if (data.status) {
                    button.innerHTML = 'Listed';
                    showProductsByCategory(categoryId);
                  } else {
                    button.innerHTML = 'UnListed';
                    hideProductsByCategory(categoryId);
                  }
                })
                .catch(error => {
                  console.log(error.message);
                });

              Swal.fire('Updated!', 'The category status has been updated.', 'success');
            }
          });
        }

        function hideProductsByCategory(categoryId) {
          const products = document.querySelectorAll(`[data-category-id='${categoryId}']`);
          products.forEach(product => {
            product.style.display = 'none';
          });
        }

        function showProductsByCategory(categoryId) {
          const products = document.querySelectorAll(`[data-category-id='${categoryId}']`);
          products.forEach(product => {
            product.style.display = '';
          });
        }


        // Delete Category
        async function deleteMe(id) {
          if (confirm("Are u sure?")) {
            const response = await fetch(`/admin/categories/${id}`, {
              method: 'DELETE',
              headers: {
                'Content-Type': 'application/json'
              },
            })
            if (response.ok) {
              window.location.href = '/admin/categories'
            } else {
              console.error('failed to update category');
            }
          }
        }

      </script>
      <script>
        function goToPage(pageNumber) {
          window.location.href = `/admin/categories?page=${pageNumber}`;
        }
      </script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>

</html>