<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title> Glam Wear Admin -Users </title>
  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="vendors/feather/feather.css">
  <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
  <link rel="stylesheet" href="css/style.css">
  <style>
    .pagination {
      margin-top: 20px;
      text-align: center;
    }

    .pagination a {
      margin: 0 5px;
      padding: 10px 15px;
      text-decoration: none;
      border-radius: 5px;
    }

    .pagination .btn-secondary {
      background-color: grey;
      color: white;
      pointer-events: none;
    }

    .swal2-popup.small-alert {
      width: 300px;
      padding: .5rem;
      font-size: 0.8rem;
    }

    .text-center {
      text-align: center;
    }

    .navbar-menu-wrapper {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    }

    .navbar-menu-wrapper h1 {
      margin: 0;
      font-size: 30px;
      color: #333;
    }
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap'); /* Import bold Poppins font */

.order-details-heading {
    font-family: 'Poppins', sans-serif; /* Use Poppins font */
    font-weight: 800;                   /* Set to 700 for bold style */
    font-size: 2.5rem;                  /* Adjust font size */
    color: #333;                        /* Dark text color */
    text-align: center;                 /* Ensure text is centered */
    margin: 0;                          /* Remove default margin */
    padding: 20px;                      /* Add padding around the heading */
}
.sidebar {
  background-color: #343a40;
    position: fixed; /* Keeps the sidebar in a fixed position */
    top: 30px; /* Aligns it to the top */
    left: 0; /* Aligns it to the left */
    width: 250px; /* Adjust as needed */
    height: 100%; /* Full height */
    overflow-y: auto; /* Allows scrolling if the sidebar content overflows */
    z-index: 1000; /* Ensures it stays above other elements */
}

.main-panel {
    margin-left: 250px; /* Adjust based on sidebar width */
    padding: 20px; /* Add padding to the main content */
}
.brand-logo {
    display: flex; /* Flexbox can help with alignment */
    align-items: center; /* Center vertically */
}

.logo-img {
    width: 215px !important; /* Desired width */
    height: auto !important; /* Maintain aspect ratio */
}
  </style>
</head>

<body>
  <div class="container-scroller">
    <!-- Navbar -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center" style="background-color: #343a40;">
        <a class="navbar-brand brand-logo" href="">
          <img class="logo-img" src="/assets/images/whtundebrwn.png" alt="Molla Logo">
      </a>
        <a class="navbar-brand brand-logo-mini" href="index.html"><img src="images/glamundrwht.svg" alt="logo" /></a>
      </div>
      <div class="navbar-menu-wrapper d-flex flex-grow-1 align-items-center justify-content-center">
          <h1 class="text-center mb-0 order-details-heading">Customers</h1>
      </div>
  </nav>
  
    <div class="container-fluid page-body-wrapper">

      <!-- Sidebar -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="user-profile">
          <div class="user-image">
            <img src="images/faces/admin.jpg">
          </div>
          <div class="user-name">
            Fahmida Sherin
          </div>
          <div class="user-designation">
            Manager
          </div>
        </div>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="/admin/dashboard">
              <i class="icon-box menu-icon"></i>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/custommer">
              <i class="icon-command menu-icon"></i>
              <span class="menu-title">Customers</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/categories">
              <i class="icon-disc menu-icon"></i>
              <span class="menu-title">Category</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/products">
              <i class="icon-file menu-icon"></i>
              <span class="menu-title">Products</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/order">
              <i class="icon-pie-graph menu-icon"></i>
              <span class="menu-title">Orders</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/coupons">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Coupons</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/offers">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Offers</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/salesReport">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Sales Report</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/logout">
              <i class="icon-head menu-icon"></i>
              <span class="menu-title">Logout</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Main Content-->

      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row">
            <div class="col-lg-12 grid-margin stretch-card  ">
              <div class="card">
                <div class="card-body">
                  <div class="table-responsive ">
                    <table class="table table-striped w-100 ">
                      <thead>
                        <tr>
                          <th>
                            Index
                          </th>
                          <th>
                            User Name
                          </th>
                          <th>
                            Mobile
                          </th>
                          <th>
                            Email
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <% users.forEach( function(user,Index){ %>
                          <tr>
                            <td>
                              <%= Index+1 %>
                            </td>
                            <td>
                              <%= user.name %>
                            </td>
                            <td>
                              <%= user.mobile %>
                            </td>
                            <td>
                              <%= user.email %>
                            </td>
                            <td>
                              <% if (!user.is_blocked) { %>
                                <button class="btn btn-danger block-btn" type="button"
                                  data-userid="<%= user._id %>">Block</button>
                                <% } else { %>
                                  <button class="btn btn-success unblock-btn" type="button"
                                    data-userid="<%= user._id %>">Unblock</button>
                                  <% } %>
                            </td>
                          </tr>
                          <% }) %>
                      </tbody>
                    </table>
                    <div class="pagination">
                      <% if (currentPage> 1) { %>
                        <a href="?page=<%= currentPage - 1 %>&limit=<%= limit %>" class="btn btn-primary">Previous</a>
                        <% } %>

                          <% for (let i=1; i <=totalPages; i++) { %>
                            <a href="?page=<%= i %>&limit=<%= limit %>"
                              class="btn <%= i === currentPage ? 'btn-secondary' : 'btn-primary' %>">
                              <%= i %>
                            </a>
                            <% } %>

                              <% if (currentPage < totalPages) { %>
                                <a href="?page=<%= currentPage + 1 %>&limit=<%= limit %>"
                                  class="btn btn-primary">Next</a>
                                <% } %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const buttons = document.querySelectorAll('.block-btn, .unblock-btn')

          buttons.forEach(function (button) {
            button.addEventListener('click', function () {
              const userId = this.getAttribute('data-userid')
              const action = this.classList.contains('block-btn') ? 'block' : 'unblock'

              Swal.fire({
                title: `Confirm ${action}?`,
                icon: action === 'block' ? 'warning' : 'info',
                showCancelButton: true,
                confirmButtonText: 'Yes',
                cancelButtonText: 'No',
                buttonsStyling: true,
                confirmButtonColor: action === 'block' ? '#d33' : '#28a745',
                cancelButtonColor: '#6c757d',
                customClass: {
                  popup: 'small-alert'
                }
              }).then((result) => {
                if (result.isConfirmed) {
                  fetch(`/admin/custommer/${userId}/${action}`, {
                    method: 'PATCH',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ userId })
                  })
                    .then(response => {
                      if (response.ok) {
                        Swal.fire({
                          title: `${action.charAt(0).toUpperCase() + action.slice(1)}d!`,
                          icon: 'success',
                          timer: 1000,
                          showConfirmButton: false,
                          toast: true,
                          position: 'top-end'
                        }).then(() => {
                          location.reload();
                        });
                      } else {
                        Swal.fire('Failed!', 'Try again later.', 'error');
                      }
                    })
                    .catch(() => {
                      Swal.fire('Error!', 'Something went wrong.', 'error');
                    });
                }
              });
            });
          });
        });
      </script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>