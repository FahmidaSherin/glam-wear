<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title> Glam Wear Admin -Dashboard </title>
  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="vendors/feather/feather.css">
  <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
  <link rel="stylesheet" href="vendors/flag-icon-css/css/flag-icon.min.css" />
  <link rel="stylesheet" href="vendors/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="vendors/jquery-bar-rating/fontawesome-stars-o.css">
  <link rel="stylesheet" href="vendors/jquery-bar-rating/fontawesome-stars.css">
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap'); /* Import bold Poppins font */

.navbar-menu-wrapper {
    width: 100%;                    
    display: flex;                   
    justify-content: space-between;  
    align-items: center;            
}

.order-details-heading {
    font-family: 'Poppins', sans-serif;
    font-weight: 600;                  
    font-size: 2.3rem;                  
    color: #333;                        
    text-align: center;                 
    flex-grow: 1;                      
    margin: 0;                          
    padding: 20px;                    
}

.navbar-nav-right {
    margin-left: auto; 
}

.sidebar {
  background-color: #343a40;
    position: fixed; /* Keeps the sidebar in a fixed position */
    top: 30px; /* Aligns it to the top */
    left: 0; /* Aligns it to the left */
    width: 250px; /* Adjust as needed */
    height: 100%; /* Full height */
    overflow-y: auto; /* Allows scrolling if the sidebar content overflows */
    z-index: 1000; /* Ensures it stays above other elements */
}

.brand-logo {
    display: flex; /* Flexbox can help with alignment */
    align-items: center; /* Center vertically */
}
.navbar {
    background-color: #343a40; /* Same color as the sidebar */
     /* Ensure the text or logo is visible */
}


.logo-img {
    width: 215px !important; /* Desired width */
    height: auto !important; /* Maintain aspect ratio */
}
/* Main content area */
.page-body-wrapper {
    margin-left: 250px; /* Space for sidebar */
    margin-top: 60px; /* Space for navbar */
    padding: 20px; /* Optional padding */
    overflow: auto; /* Allow scrolling for the main content */
    height: calc(100vh - 60px); /* Fill the remaining height */
}
.table {
  margin-top: 20px;
}

.product-image {
  width: 60px; /* Adjust as necessary */
  height: auto;
  border-radius: 4px; /* Rounded corners for images */
}

.table-light th {
  background-color: #f8f9fa; /* Light background for headers */
  color: #343a40; /* Darker text color for contrast */
}

.table-hover tbody tr:hover {
  background-color: #f1f1f1; /* Light gray background on hover */
}

.text-center {
  color: #6c757d; 
  font-style: italic;
}

.grid-margin {
  margin-bottom: 20px; 
}

.card-title {
  font-family: 'Roboto', sans-serif; 
  font-size: 2.75rem;
  font-weight: 700; /* Medium weight for better visibility */
  color: #343a40; /* Darker color for better contrast */
  background-color: #f8f9fa; /* Light background for emphasis */
  padding: 15px; /* Add padding for a spacious feel */
  border-radius: 5px; /* Rounded corners for a softer look */
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
  margin-bottom: 20px; /* Space below the heading */
  text-align: center; /* Center the heading */
}
.navbar-brand-wrapper {
    background-color: #343a40; /* Apply the background color to the wrapper */
}



    
    </style>
</head>

<body>
  <div class="container-scroller">
    <!-- Navbar -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center" style="background-color: #343a40;">
        <a class="navbar-brand brand-logo" href="">
            <img class="logo-img" src="/assets/images/whtundebrwn.png" alt="Molla Logo">
        </a>
        <a class="navbar-brand brand-logo-mini" href="index.html">
            <img src="images/whtundebrwn.svg" alt="logo" />
        </a>
    </div>
      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-center">
        <h1 class="text-center mb-4 order-details-heading" style="color: black;">Dashboard</h1>
    </div>
    </nav>
    <div class="container-fluid page-body-wrapper">
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="user-profile">
          <div class="user-image">
            <img src="images/faces/admin.jpg">
          </div>
          <div class="user-name">
            Fahmida Sherin
          </div>
          <div class="user-designation">
            Manager
          </div>
        </div>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="/admin/dashboard">
              <i class="icon-box menu-icon"></i>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/custommer">
              <i class="icon-command menu-icon"></i>
              <span class="menu-title">Customers</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/categories">
              <i class="icon-disc menu-icon"></i>
              <span class="menu-title">Category</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/products">
              <i class="icon-file menu-icon"></i>
              <span class="menu-title">Products</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/order">
              <i class="icon-pie-graph menu-icon"></i>
              <span class="menu-title">Orders</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/coupons">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Coupons</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/offers">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Offers</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/salesReport">
              <i class="icon-help menu-icon"></i>
              <span class="menu-title">Sales Report</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/admin/logout">
              <i class="icon-head menu-icon"></i>
              <span class="menu-title">Logout</span>
            </a>
          </li>

        </ul>
      </nav>


      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row">
            <div class="col-sm-12 mb-4 mb-xl-0">
              <h4 class="font-weight-bold text-dark">Hi, welcome back!</h4>
              <p class="font-weight-normal mb-2 text-muted">
                <%= new Date().toLocaleDateString('en-Us',{year:'numeric',month:'long',day:'2-digit'}) %>
              </p>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-3 col-sm-3 grid-margin stretch-card">
              <div class="card hover-up" style="border-radius: 10px;">
                <div class="card-body">
                  <div class="icon-with-title">
                    <div class="circle-icon">
                      <i class="bi bi-coin" style="color: green; font-size: 28px;"></i>
                    </div>
                    <h4 class="card-title">Total Revenue</h4>
                  </div><br>
                  <h4 class="align-content-end ">₹<%= revenue %>
                  </h4>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-3 grid-margin stretch-card">
              <div class="card  hover-up" style="border-radius: 10px;">
                <div class="card-body">
        
                  <div class="icon-with-title">
                    <div class="circle-icon">
                      <i class="bi bi-truck" style="color: green; font-size: 28px;"></i>
                    </div>
                    <h4 class="card-title">Total Orders</h4>
                  </div><br>
                  <h4 class="align-content-end ">
                    <%= salesCount %>
                  </h4>
                </div>
              </div>
            </div>
            <div class="col-xl-3 col-sm-3 grid-margin stretch-card">
              <div class="card hover-up" style="border-radius: 10px;">
                <div class="card-body">
                  <div class="icon-with-title">
                    <div class="circle-icon">
                      <i class="bi bi-qr-code" style="color: green; font-size: 28px;"></i>
                    </div>
                    <h4 class="card-title mb-3">Daily revenue</h4>
                  </div><br>
                  <h4 class="align-content-end ">₹<%= dailyRevenue %>
                  </h4>
                </div>
              </div>
            </div>
          </div>
        
          <div class="col-xl-12 d-flex grid-margin stretch-card">
            <div class="card">
              <div class="card-body ">
                <select id="graphSelector" class="form-select  btn btn-outline-danger" onchange="loadGraph()"
                  aria-label="Default select example">
                  <option value="monthly">Monthly</option>
                  <option value="yearly">Yearly</option>
                  <option value="weekly"> Weekly</option>
                </select>
                <div>
                  <canvas id="myChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        
          <div class="row">
            <div class="col-lg-6 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Top 10 Products</h4>
                  <div class="table-responsive">
                    <table class="table table-hover table-striped">
                      <thead class="thead-dark">
                        <tr>
                          <th>No</th>
                          <th>Name</th>
                          <th>Image</th>
                          <th>Sold</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% if (top10Products.length > 0) { %>
                          <% top10Products.forEach((product, index) => { %>
                            <tr>
                              <td><%= index + 1 %></td>
                              <td><%= product.name %></td>
                              <td>
                                <% if (product.image && product.image.length > 0) { %>
                                  <img src="/upload/<%= product.image[0] %>" alt="<%= product.name %>" class="product-image" />
                                <% } else { %>
                                  <span>No Image Available</span>
                                <% } %>
                              </td>
                              <td><%= product.count %></td>
                            </tr>
                          <% }); %>
                        <% } else { %>
                          <tr>
                            <td colspan="4" class="text-center">No products found</td>
                          </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          
            <div class="col-lg-6 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Top 10 Categories</h4>
                  <div class="table-responsive">
                    <table class="table table-hover table-striped">
                      <thead class="thead-dark">
                        <tr>
                          <th>No</th>
                          <th>Name</th>
                          <th>Sold</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% if (top10Categories.length > 0) { %>
                          <% top10Categories.forEach((category, index) => { %>
                            <tr>
                              <td><%= index + 1 %></td>
                              <td><%= category.categoryName %></td>
                              <td><%= category.count %></td>
                            </tr>
                          <% }); %>
                        <% } else { %>
                          <tr>
                            <td colspan="3" class="text-center">No categories found</td>
                          </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
          </div>

        </footer>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>

    document.addEventListener('DOMContentLoaded', function () {
      loadGraph()
    })

    async function loadGraph() {
      const selector = document.getElementById('graphSelector');
      const selectedValue = selector.value;
      console.log(selectedValue, 'selected value in admin dashboard page');

      try {
        const response = await fetch(`/admin/dashboard/graph/value?value=${selectedValue}`);
        const data = await response.json();
        console.log(data, 'data in dashboard admin side');

        let labels = [];
        let revenueData = [];
        let salesCountData = [];

        if (selectedValue === 'monthly') {
          labels = data.map(item => new Date(2000, item.month - 1).toLocaleString('default', { month: 'short' }));
          revenueData = data.map(item => item.monthlyTotalAmount);
          salesCountData = data.map(item => item.monthlyOrderCount);
        } else if (selectedValue === 'yearly') {
          labels = data.map(item => item._id);
          revenueData = data.map(item => item.yearlyTotalAmount);
          salesCountData = data.map(item => item.yearlyOrderCount);
        } else if (selectedValue === 'weekly') {
          labels = data.map(item => `Week ${item.week}`);
          revenueData = data.map(item => item.weeklyTotalAmount);
          salesCountData = data.map(item => item.weeklyOrderCount);
        }

        const ctx = document.getElementById('myChart');

        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Revenue',
              data: revenueData,
              backgroundColor: 'rgba(255, 99, 132, 0.5)',
              borderColor: 'rgba(255, 99, 132, 1)',
              yAxisID: 'revenue-y-axis',
              borderWidth: 1
            }, {
              label: 'Sales Count',
              data: salesCountData,
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              borderColor: 'rgba(54, 162, 235, 1)',
              yAxisID: 'sales-y-axis',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              yAxes: [{
                id: 'revenue-y-axis',
                type: 'linear',
                position: 'left',
                ticks: {
                  beginAtZero: true,
                  callback: function (value, index, values) {
                    return value.toLocaleString();
                  }
                },
                scaleLabel: {
                  display: true,
                  labelString: 'Revenue'
                }
              }, {
                id: 'sales-y-axis',
                type: 'linear',
                position: 'right',
                ticks: {
                  beginAtZero: true,
                  stepSize: 1
                },
                gridLines: {
                  display: false
                },
                scaleLabel: {
                  display: true,
                  labelString: 'Sales Count'
                }
              }],
              xAxes: [{
                scaleLabel: {
                  display: true,
                  labelString: selectedValue === 'monthly' ? 'Months' : selectedValue === 'yearly' ? 'Years' : 'Weeks'
                }
              }]
            }
          }
        });
      } catch (error) {
        console.error('Error loading graph:', error);
      }
    }

  </script>
  <script src="/admin/vendors/base/vendor.bundle.base.js"></script>
  <script src="js/off-canvas.js"></script>
  <script src="js/hoverable-collapse.js"></script>
  <script src="js/template.js"></script>
  <script src="/admin/vendors/chart.js/Chart.min.js"></script>
  <script src="/admin/vendors/jquery-bar-rating/jquery.barrating.min.js"></script>
  <script src="js/dashboard.js"></script>
</body>

</html>